## 修复实时聊天功能

### 问题分析
聊天记录必须手动刷新才能显示，无法实时获取最新消息。经过分析，可能的原因包括：
1. 事件处理函数中的错误被忽略，无法定位问题
2. 通道订阅状态不正确
3. Supabase 实时功能配置问题
4. 过滤条件可能存在问题

### 修复方案

#### 1. 添加调试日志
- 在事件处理函数中添加详细的日志，查看事件是否被正确触发
- 在通道订阅状态变化时添加日志
- 在组件挂载和卸载时添加日志

#### 2. 检查通道订阅状态
- 确保通道订阅成功
- 添加连接状态的可视化反馈
- 改进连接状态的处理逻辑

#### 3. 优化事件处理函数
- 移除不必要的 try-catch 块，或者添加详细的错误日志
- 简化事件处理逻辑，确保消息能被正确添加到消息列表
- 确保消息排序正确

#### 4. 检查 Supabase 实时功能配置
- 检查 Supabase 控制台中是否启用了实时功能
- 确保表的 RLS 策略允许实时订阅
- 确保表的 WAL 级别设置正确

#### 5. 简化过滤条件
- 尝试简化过滤条件，看看是否能捕获到事件
- 确保过滤条件的语法正确

#### 6. 改进组件卸载逻辑
- 确保组件卸载时正确取消订阅
- 避免内存泄漏

### 实施步骤

1. **在私聊界面添加调试日志**
   - 修改 `src/components/ChatInterface.tsx`，添加调试日志
   - 检查事件处理函数是否被正确调用

2. **在群聊界面添加调试日志**
   - 修改 `src/app/chat/group/[groupId]/page.tsx`，添加调试日志
   - 检查事件处理函数是否被正确调用

3. **检查连接状态**
   - 确保连接状态正确反映通道的实际状态
   - 添加连接状态的可视化反馈

4. **简化事件处理逻辑**
   - 移除不必要的 try-catch 块
   - 简化消息添加逻辑

5. **测试实时功能**
   - 使用 Supabase 控制台的实时监听器测试功能
   - 测试私聊和群聊的实时消息功能

### 预期效果
- 实时消息能够正常显示，不需要手动刷新
- 连接状态能够正确反映通道的实际状态
- 能够看到详细的调试日志，便于定位问题
- 私聊和群聊的实时功能都能正常工作
