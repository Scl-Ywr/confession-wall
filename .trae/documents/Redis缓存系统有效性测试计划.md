# Redis缓存系统有效性测试计划

## 测试目标
全面验证Redis缓存系统在用户访问场景下的有效性，包括缓存写入、读取、命中率、过期策略和性能表现。

## 测试环境
- 开发服务器：http://localhost:3000
- Redis服务器：本地Redis实例
- 测试工具：curl、Redis CLI、浏览器开发者工具

## 测试内容与步骤

### 1. 首次访问缓存写入测试
**测试目标**：验证首次访问时数据从数据库加载并写入Redis

**测试步骤**：
1. 清除Redis中所有现有缓存键
2. 访问首页：`curl -s http://localhost:3000`
3. 查看Redis缓存键：`mcp_Redis_list pattern="confession_wall:*"`
4. 查看特定缓存键内容：`mcp_Redis_get key="confession_wall:confession:list:1:10"`

**预期结果**：
- Redis中出现新的缓存键
- 缓存键包含表白列表数据
- 数据结构符合预期

### 2. 非首次访问缓存优先测试
**测试目标**：验证非首次访问时优先从Redis获取数据

**测试步骤**：
1. 首次访问：`curl -s http://localhost:3000`
2. 第二次访问：`curl -s http://localhost:3000`
3. 查看缓存统计：`curl -s http://localhost:3000/api/cache-statistics`
4. 查看特定缓存键的命中次数：`mcp_Redis_get key="confession_wall:confession:list:1:10"`

**预期结果**：
- 第二次访问后，缓存统计显示hit次数增加
- 特定缓存键的hits字段值大于0

### 3. 不同场景下的缓存命中率测试
**测试目标**：测试不同用户角色、访问频率下的命中率

**测试步骤**：
1. 清除所有缓存
2. 模拟普通用户访问5次：循环执行`curl -s http://localhost:3000`
3. 查看缓存统计
4. 模拟登录用户访问5次：`curl -s http://localhost:3000/profile/719224d2-6542-4cfe-a64c-4b23f851530b`
5. 查看缓存统计和用户相关缓存键

**预期结果**：
- 普通用户访问后命中率逐步提高
- 登录用户访问后生成用户特定缓存
- 不同类型缓存的命中率存在差异

### 4. 缓存过期和更新机制测试
**测试目标**：验证缓存过期和更新机制

**测试步骤**：
1. 创建一个测试缓存键：`mcp_Redis_set key="test:expiry" value="test" expireSeconds=10`
2. 立即获取该键：`mcp_Redis_get key="test:expiry"`
3. 等待15秒后再次获取
4. 更新现有缓存：修改`src/services/confessionService.ts`中的获取逻辑
5. 访问首页，查看缓存是否更新

**预期结果**：
- 15秒后测试键过期，返回null
- 数据更新后，相关缓存键被清除或更新
- 重新访问时生成新的缓存数据

### 5. 性能对比测试
**测试目标**：比较缓存响应时间与数据库直连响应时间

**测试步骤**：
1. 清除所有缓存
2. 测试首次访问响应时间：`time curl -s http://localhost:3000 > /dev/null`
3. 测试二次访问响应时间：`time curl -s http://localhost:3000 > /dev/null`
4. 测试多次访问的平均响应时间
5. 访问缓存统计API，获取详细性能数据

**预期结果**：
- 二次访问响应时间明显小于首次访问
- 多次访问的平均响应时间较低
- 缓存命中率持续提高

## 测试数据收集
- 每次测试前后的缓存键列表
- 缓存统计数据（hits、misses、hitRate）
- 各请求的响应时间
- 缓存键的命中次数和过期时间
- 不同访问场景下的缓存行为

## 测试报告生成
测试完成后，将生成包含以下内容的测试报告：
- 测试环境和配置
- 详细测试步骤
- 输入参数和预期结果
- 实际测试结果
- 性能对比分析
- 发现的问题和建议
- 结论和优化建议

## 风险与注意事项
- 确保测试环境稳定，无其他服务干扰
- 注意缓存统计的采样率设置（10%）可能影响统计结果
- 测试过程中避免并发操作影响测试数据
- 记录测试时间和环境状态

## 测试工具准备
- Redis CLI工具
- curl命令行工具
- 浏览器开发者工具
- 时间测量工具（time命令）